#!/usr/bin/env bash


module load java/1.8 python/2.7
source /work/pavlov/okochenova/profile

USERDIR="/work/pavlov/okochenova/"
WORKDIR=${USERDIR}"combined_sets/"

COMBINED_DIR=${WORKDIR}"filtered/"
PER_SAMPLE_DIR=${WORKDIR}"per_sample_vcf/"
RAW_VCF_DIR=${USERDIR}"best_SNP/"

MAVR_DIR="/work/pavlov/okochenova/soft/MAVR/"
SCRIPT_PATH="scripts/snpcall/intersect_vcf.py"
ABS_SCRIPT_PATH=${MAVR_DIR}${SCRIPT_PATH}

SAMPLE_SETS=(PmCDA1_D1 PmCDA1_D3 PmCDA1_D6 A1_D1 A1_D3 A1_D6 AID_D1 AID_D3 AID_D6)
PmCDA1_D1=(N085-LAN210-Can-PmCDA1-NA-RUN7-D1 N086-LAN210-Can-PmCDA1-NA-RUN7-D1 N087-LAN210-Can-PmCDA1-NA-RUN7-D1 N088-LAN210-Can-PmCDA1-NA-RUN7-D1 N089-LAN210-Can-PmCDA1-NA-RUN7-D1 N090-LAN210-Can-PmCDA1-NA-RUN7-D1)
PmCDA1_D3=(N010-LAN210-Can-PmCDA1-NA-RUN2-D3 N011-LAN210-Can-PmCDA1-NA-RUN2-D3 N012-LAN210-Can-PmCDA1-NA-RUN2-D3 N013-LAN210-Can-PmCDA1-NA-RUN2-D3 N058-LAN210-Can-PmCDA1-Feb13-RUN5-D3 N059-LAN210-FOA-PmCDA1-Feb13-RUN5-D3 N091-LAN210-Can-PmCDA1-NA-RUN7-D3 N060-LAN210-FOA-PmCDA1-Feb13-RUN5-D3 N061-LAN210-Can-PmCDA1-NA-RUN5-D3 N062-LAN210-Can-PmCDA1-NA-RUN5-D3 N065-LAN210-Can-PmCDA1-NA-RUN6-D3 N066-LAN210-Can-PmCDA1-NA-RUN6-D3)
PmCDA1_D6=(N070-LAN210-Can-PmCDA1-NA-RUN6-D6 N071-LAN210-Can-PmCDA1-NA-RUN6-D6 N072-LAN210-Can-PmCDA1-NA-RUN6-D6 N073-LAN210-Can-PmCDA1-NA-RUN6-D6 N092-LAN210-Can-PmCDA1-NA-RUN7-D6 N093-LAN210-Can-PmCDA1-NA-RUN7-D6 N094-LAN210-Can-PmCDA1-NA-RUN7-D6 N095-LAN210-Can-PmCDA1-NA-RUN7-D6 N096-LAN210-Can-PmCDA1-NA-RUN7-D6)

A1_D1=(N107-LAN210-Can-A1-NA-RUN7-D1 N108-LAN210-Can-A1-NA-RUN7-D1 N109-LAN210-Can-A1-NA-RUN7-D1 N110-LAN210-Can-A1-NA-RUN7-D1 N111-LAN210-Can-A1-NA-RUN7-D1 N112-LAN210-Can-A1-NA-RUN7-D1)
A1_D3=(N034-LAN210-Can-A1-Oct12-RUN4-D3 N035-LAN210-Can-A1-Oct12-RUN4-D3 N036-LAN210-FOA-A1-Oct12-RUN4-D3 N037-LAN210-FOA-A1-Oct12-RUN4-D3 N113-LAN210-Can-A1-NA-RUN7-D3 N114-LAN210-Can-A1-NA-RUN7-D3 N115-LAN210-Can-A1-NA-RUN7-D3 N116-LAN210-Can-A1-NA-RUN7-D3 N117-LAN210-Can-A1-NA-RUN7-D3 N118-LAN210-Can-A1-NA-RUN7-D3)
A1_D6=(N120-LAN210-Can-A1-NA-RUN7-D6 N121-LAN210-Can-A1-NA-RUN7-D6 N122-LAN210-Can-A1-NA-RUN7-D6 N123-LAN210-Can-A1-NA-RUN7-D6 N124-LAN210-Can-A1-NA-RUN7-D6 N079-LAN210-Can-A1-NA-RUN6-D6 N080-LAN210-Can-A1-NA-RUN6-D6)

AID_D1=(N097-LAN210-Can-AID-NA-RUN7-D1 N098-LAN210-Can-AID-NA-RUN7-D1)
AID_D3=(N040-LAN210-Can-AID-Oct12-RUN4-D3 N041-LAN210-Can-AID-Oct12-RUN4-D3 N100-LAN210-Can-AID-NA-RUN7-D3 N101-LAN210-Can-AID-NA-RUN7-D3 N102-LAN210-Can-AID-NA-RUN7-D3)
AID_D6=(N103-LAN210-Can-AID-NA-RUN7-D6 N104-LAN210-Can-AID-NA-RUN7-D6 N105-LAN210-Can-AID-NA-RUN7-D6 N106-LAN210-Can-AID-NA-RUN7-D6 N077-LAN210-Can-AID-NA-RUN6-D6 N078-LAN210-Can-AID-NA-RUN6-D6)

mkdir -p ${PER_SAMPLE_DIR}

for SET in ${SAMPLE_SETS[@]};
    do
    SET_VCF=${COMBINED_DIR}${SET}"_adjusted_cluster_mutations.vcf"
    SAMPLE_LIST=$(eval "echo \${"${SET}[@]"}")

    for SAMPLE in ${SAMPLE_LIST};
        do
        OUT_VCF=${PER_SAMPLE_DIR}${SAMPLE}".vcf"
        SAMPLE_VCF=${RAW_VCF_DIR}${SAMPLE}"_GATK_best_SNP.vcf"
        ${ABS_SCRIPT_PATH} -a ${SAMPLE_VCF} -b ${SET_VCF} -o ${OUT_VCF}
        done

    done

