#!/usr/bin/env bash

source ./DESCRIPTION

BOWTIE2_INDEX=${WORKDIR}"index/mating_rel_seqs"

MAVR_SCRIPTS_DIR=${MAVR_DIR}"/scripts/"
RESTORE_PAIRS_SCRIPT=${MAVR_SCRIPTS_DIR}"filter/restore_pairs.py"
MAP_SCRIPT=${MAVR_SCRIPTS_DIR}"alignment/map_reads.py"

EXTRACTOR_BIN="extract"
FRAGMENTS_FILE=${WORKDIR}"kmer/mating_rel_seqs_with_rev_com_33_mer.kmer"
SAMPLES_DIR="/media/mahajrod/d9e6e5ee-1bf7-4dba-934e-3f898d9611c8/Data/LAN2xx/all/"

SAMPLES=(N001-LAN200-wt-NA-NA-RUN1 N058-LAN210-Can-PmCDA1-Feb13-RUN5-D3 N002-LAN201-wt-NA-NA-RUN1 N059-LAN210-FOA-PmCDA1-Feb13-RUN5-D3 N006-LAN211-Can-HAP-NA-RUN1 N060-LAN210-FOA-PmCDA1-Feb13-RUN5-D3 N007-LAN211-Can-HAP-NA-RUN1 N061-LAN210-Can-PmCDA1-NA-RUN5-D3 N008-LAN210-wt-NA-NA-RUN2 N062-LAN210-Can-PmCDA1-NA-RUN5-D3 N010-LAN210-Can-PmCDA1-NA-RUN2-D3 N065-LAN210-Can-PmCDA1-NA-RUN6-D3 N011-LAN210-Can-PmCDA1-NA-RUN2-D3 N066-LAN210-Can-PmCDA1-NA-RUN6-D3 N012-LAN210-Can-PmCDA1-NA-RUN2-D3 N067-LAN210_sub1KanMX-Can-PmCDA1-NA-RUN6-D3 N013-LAN210-Can-PmCDA1-NA-RUN2-D3 N068-LAN210_sub1KanMX-Can-PmCDA1-NA-RUN6-D3 N014-LAN211-Can-HAP-NA-RUN2 N069-LAN210_sub1KanMX-Can-PmCDA1-NA-RUN6-D3 N015-LAN211-Can-HAP-NA-RUN2 N070-LAN210-Can-PmCDA1-NA-RUN6-D6 N016-LAN211-Can-HAP-NA-RUN2 N071-LAN210-Can-PmCDA1-NA-RUN6-D6 N017-LAN211-Can-HAP-NA-RUN2 N072-LAN210-Can-PmCDA1-NA-RUN6-D6 N018-LAN211-Can-HAP-NA-RUN2 N073-LAN210-Can-PmCDA1-NA-RUN6-D6 N019-LAN211-Can-HAP-NA-RUN2 N074-LAN210_sub1KanMX-Can-PmCDA1-NA-RUN6-D6 N034-LAN210-Can-A1-Oct12-RUN4-D3 N075-LAN210_sub1KanMX-Can-PmCDA1-NA-RUN6-D6 N035-LAN210-Can-A1-Oct12-RUN4-D3 N076-LAN210_sub1KanMX-Can-PmCDA1-NA-RUN6-D6 N036-LAN210-FOA-A1-Oct12-RUN4-D3 N077-LAN210-Can-AID-NA-RUN6-D6 N037-LAN210-FOA-A1-Oct12-RUN4-D3 N078-LAN210-Can-AID-NA-RUN6-D6 N038-LAN210-Can-A3G-Oct12-RUN4-D3 N079-LAN210-Can-A1-NA-RUN6-D6 N039-LAN210-Can-A3G-Oct12-RUN4-D3 N080-LAN210-Can-A1-NA-RUN6-D6 N040-LAN210-Can-AID-Oct12-RUN4-D3 N081-LAN210_sub1KanMX-Can-HAP-NA-RUN6 N041-LAN210-Can-AID-Oct12-RUN4-D3 N082-LAN210_sub1KanMX-Can-HAP-NA-RUN6 N050-LAN211-Can-HAP-NA-RUN4 N083-LAN210_sub1KanMX-Can-UV-NA-RUN6 N051-LAN211-Can-HAP-NA-RUN4 N084-LAN210_sub1KanMX-Can-UV-NA-RUN6)
for SAMPLE in ${SAMPLES[@]};
    do
    cd ${WORKDIR}

    CURRENT_SAMPLE=${SAMPLE}

    mkdir -p ${CURRENT_SAMPLE}
    cd ${CURRENT_SAMPLE}
    echo ${CURRENT_SAMPLE}

    READS=(`ls ${SAMPLES_DIR}${SAMPLE}/trimmed/spades/corrected/ | grep -P ".*R1.*.fastq$|.*R2.*.fastq$"`)
    LEFT_READS_FILE=${SAMPLES_DIR}${SAMPLE}/trimmed/spades/corrected/${READS[0]}
    RIGHT_READS_FILE=${SAMPLES_DIR}${SAMPLE}/trimmed/spades/corrected/${READS[1]}
    #${EXTRACTOR_BIN} --fragments ${FRAGMENTS_FILE} -o ./ -1 ${LEFT_READS_FILE} -2 ${RIGHT_READS_FILE}

    READ_BASENAME=`basename ${READS[0]} .fastq`
    mkdir -p both_reads
    mkdir -p all_reads

    EXTRACTED_READS_FILE_LEFT=${READ_BASENAME}".filtered.fastq"
    EXTRACTED_READS_FILE_LEFT_SE=${READ_BASENAME}".se.fastq"
    EXTRACTED_READS_FILE_RIGHT=${READ_BASENAME}".filtered.fastq"
    EXTRACTED_READS_FILE_RIGHT_SE=${READ_BASENAME}".se.fastq"

    BOTH_PREFIX=./both_reads/${CURRENT_SAMPLE}"_both"
    ALL_PREFIX=./all_reads/${CURRENT_SAMPLE}"_all"



    ${MAP_SCRIPT} -i ${BOWTIE2_INDEX} -t 4 -r ${BOTH_PREFIX}"_1.fastq" -l ${BOTH_PREFIX}"_2.fastq" \
                  -p ${BOTH_PREFIX} -g -y ${BOTH_PREFIX}"_coverage.bed" -z -x
    ${MAP_SCRIPT} -i ${BOWTIE2_INDEX} -t 4 -r ${ALL_PREFIX}"_1.fastq" -l ${ALL_PREFIX}"_2.fastq" \
                  -p ${ALL_PREFIX} -g -y ${ALL_PREFIX}"_coverage.bed" -z -x

    done
