#!/usr/bin/env bash

source ./DESCRIPTION

BOWTIE2_INDEX=${WORKDIR}"index/mating_rel_seqs"

MAVR_SCRIPTS_DIR=${MAVR_DIR}"/scripts/"
RESTORE_PAIRS_SCRIPT=${MAVR_SCRIPTS_DIR}"filter/restore_pairs.py"
MAP_SCRIPT=${MAVR_SCRIPTS_DIR}"alignment/map_reads.py"

SAMPLES=(N085-LAN210-Can-PmCDA1-NA-RUN7-D1 N086-LAN210-Can-PmCDA1-NA-RUN7-D1 N087-LAN210-Can-PmCDA1-NA-RUN7-D1 N088-LAN210-Can-PmCDA1-NA-RUN7-D1 N089-LAN210-Can-PmCDA1-NA-RUN7-D1 N090-LAN210-Can-PmCDA1-NA-RUN7-D1 N091-LAN210-Can-PmCDA1-NA-RUN7-D3 N092-LAN210-Can-PmCDA1-NA-RUN7-D6 N093-LAN210-Can-PmCDA1-NA-RUN7-D6 N094-LAN210-Can-PmCDA1-NA-RUN7-D6 N095-LAN210-Can-PmCDA1-NA-RUN7-D6 N096-LAN210-Can-PmCDA1-NA-RUN7-D6 N097-LAN210-Can-AID-NA-RUN7-D1 N098-LAN210-Can-AID-NA-RUN7-D1 N100-LAN210-Can-AID-NA-RUN7-D3 N101-LAN210-Can-AID-NA-RUN7-D3 N102-LAN210-Can-AID-NA-RUN7-D3 N103-LAN210-Can-AID-NA-RUN7-D6 N104-LAN210-Can-AID-NA-RUN7-D6 N105-LAN210-Can-AID-NA-RUN7-D6 N106-LAN210-Can-AID-NA-RUN7-D6 N107-LAN210-Can-A1-NA-RUN7-D1 N108-LAN210-Can-A1-NA-RUN7-D1 N109-LAN210-Can-A1-NA-RUN7-D1 N110-LAN210-Can-A1-NA-RUN7-D1 N111-LAN210-Can-A1-NA-RUN7-D1 N112-LAN210-Can-A1-NA-RUN7-D1 N113-LAN210-Can-A1-NA-RUN7-D3 N114-LAN210-Can-A1-NA-RUN7-D3 N115-LAN210-Can-A1-NA-RUN7-D3 N116-LAN210-Can-A1-NA-RUN7-D3 N117-LAN210-Can-A1-NA-RUN7-D3 N118-LAN210-Can-A1-NA-RUN7-D3 N120-LAN210-Can-A1-NA-RUN7-D6 N121-LAN210-Can-A1-NA-RUN7-D6 N122-LAN210-Can-A1-NA-RUN7-D6 N123-LAN210-Can-A1-NA-RUN7-D6 N124-LAN210-Can-A1-NA-RUN7-D6)

for SAMPLE in ${SAMPLES[@]};
    do
    cd ${WORKDIR}

    CURRENT_SAMPLE=${SAMPLE}

    mkdir -p ${CURRENT_SAMPLE}
    cd ${CURRENT_SAMPLE}
    echo ${CURRENT_SAMPLE}
    mkdir -p both_reads
    mkdir -p all_reads

    EXTRACTED_READS_FILE_LEFT=${CURRENT_SAMPLE}"_1.ok_val_1.filtered.fastq"
    EXTRACTED_READS_FILE_LEFT_SE=${CURRENT_SAMPLE}"_1.ok_val_1.se.fastq"
    EXTRACTED_READS_FILE_RIGHT=${CURRENT_SAMPLE}"_2.ok_val_2.filtered.fastq"
    EXTRACTED_READS_FILE_RIGHT_SE=${CURRENT_SAMPLE}"_2.ok_val_2.se.fastq"

    BOTH_PREFIX=./both_reads/${CURRENT_SAMPLE}"_both"
    ALL_PREFIX=./all_reads/${CURRENT_SAMPLE}"_all"



    ${MAP_SCRIPT} -i ${BOWTIE2_INDEX} -t 4 -r ${BOTH_PREFIX}"_1.fastq" -l ${BOTH_PREFIX}"_2.fastq" \
                  -p ${BOTH_PREFIX} -g -y ${BOTH_PREFIX}"_coverage.bed" -z -x
    ${MAP_SCRIPT} -i ${BOWTIE2_INDEX} -t 4 -r ${ALL_PREFIX}"_1.fastq" -l ${ALL_PREFIX}"_2.fastq" \
                  -p ${ALL_PREFIX} -g -y ${ALL_PREFIX}"_coverage.bed" -z -x

    done
